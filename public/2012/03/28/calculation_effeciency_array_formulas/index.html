<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Calculation Efficiency</title>
  <meta name="description" content="">
  <meta name="author" content="Jon Nyman">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>@import url("//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css");
body{background-color:#c2dfff;font-family:sans-serif;color:#36465d;}body > *{margin:0 auto;width:100%}a{color:#86555c;}a:visited{color:#36465d}nav,.archive,.footer-menu,.nav-posts{text-align:center;font-size:16px;line-height:24px;}nav ul,.archive ul,.footer-menu ul,.nav-posts ul{padding:0}nav li,.archive li,.footer-menu li,.nav-posts li{list-style-type:none}nav a,.archive a,.footer-menu a,.nav-posts a{text-decoration:none;color:#36465d;padding:15px}nav a:hover,.archive a:hover,.footer-menu a:hover,.nav-posts a:hover{color:#c2dfff;background-color:#83a4d2}.posts a{padding-top:3px;padding-bottom:3px;display:block}.nav-posts{margin-top:15px;font-weight:bold;}.nav-posts .next::before{content:'«'}.nav-posts .previous::after{content:' »'}.nav-posts a{text-decoration:none}nav li,.footer-menu li{display:inline-block}h1{border-bottom:solid #36465d 1px;padding:10px;font-size:32px}footer{font-size:12px;text-align:center}header{text-align:center}header *{color:#86555c}.header-logo{display:inline-block}.header-logo > *{font-size:32px;position:relative;float:left}.hider{overflow:hidden}#t-com{animation-name:slideInRight;animation-iteration-count:1;animation-duration:3s;animation-fill-mode:forwards}#t-on,#t-space{left:0;animation-name:slideOutLeft;animation-iteration-count:1;animation-duration:5s;animation-delay:1s;animation-fill-mode:forwards}.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.hljs-name,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo{color:#86555c}.hljs-number,.hljs-preprocessor,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant{color:#987f5a}.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute{color:#a49a59}.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.ruby .hljs-symbol,.xml .hljs-cdata{color:#7d9726}.hljs-title,.css .hljs-hexcolor{color:#5b9d48}.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title{color:#83a4d2}.hljs-keyword,.javascript .hljs-function{color:#5f9182}.diff .hljs-deletion,.diff .hljs-addition{color:#22221b;display:inline-block;width:100%}.diff .hljs-deletion{background-color:#ba6236}.diff .hljs-addition{background-color:#7d9726}.diff .hljs-change{color:#36a166}.hljs{display:block;overflow-x:auto;background:#36465d;color:#c2dfff;padding:.5em;-webkit-text-size-adjust:none}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata{opacity:.5}@-moz-keyframes slideInRight{0%{transform:translateX(100%)}100%{transform:translateX(0)}}@-webkit-keyframes slideInRight{0%{transform:translateX(100%)}100%{transform:translateX(0)}}@-o-keyframes slideInRight{0%{transform:translateX(100%)}100%{transform:translateX(0)}}@keyframes slideInRight{0%{transform:translateX(100%)}100%{transform:translateX(0)}}@-moz-keyframes slideOutLeft{0%{margin-left:0}100%{margin-left:-268px}}@-webkit-keyframes slideOutLeft{0%{margin-left:0}100%{margin-left:-268px}}@-o-keyframes slideOutLeft{0%{margin-left:0}100%{margin-left:-268px}}@keyframes slideOutLeft{0%{margin-left:0}100%{margin-left:-268px}}</style>
</head>
<body>

<nav>
  <ul>
    <li>
      <a href="/">Archive</a>
    </li>
    <li>
      <a href="/about/">About</a>
    </li>
  </ul>
</nav>

<header>
  <a href="/" class="header-logo">
      <div id="t-j">J</div>
      <div class="hider">
          <div id="t-on">on</div>
      </div>
      <div id="t-space">&nbsp;</div>
      <div id="t-nyman">Nyman</div>
      <div class="hider">
          <div id="t-com">.com</div>
      </div>
  </a>
</header>


<h1>Calculation Efficiency</h1>
<article>
  <p>Chandoo had some posts on speeding up Excel worksheets, one of the posts focuses on formulas and another he let the general readers make their suggestions. I made the suggestion that people use array formulas. But most of the other suggestions said not to use array formulas since they slow down your spreadsheet. Needless to say, I was a bit confused, I have seen quite the performance boost from using array formulas.</p>

<p>So I did a little test to see why I was getting differing results. The testing showed that both of us were right. Array formulas are faster for UDFs and regular formulas are better for built in Excel functions. There might be circumstances where the opposite is true. I used Excel DNA for my UDF function. It just shows, if you are trying to make things fast, isolate a workbook with a small data set and see which method is faster.</p>

<p>My only theory on why UDFs and internal Excel formulas perform differently is that Excel has continual access to the data while UDFs need to get a copy of the data. If anyone knows if this is true or not I would like to know, so please comment.</p>

<p>One suggestion that really helped me was putting the data in order based on which formula will be executed first, which is Left to Right, Top to Bottom. My time card workbook was noticeably faster after I made these changes.</p>

<p>So this is the code I used to test the speed of the formulas:</p>

<pre><code class="language-vbscript">Sub SpeedTest()
    Dim dTimer As Double
    Dim rFormula As Range, rArray As Range
    Dim lLast As Long, i As Long
    Application.Calculation = xlCalculationManual
    Application.Iteration = False
    lLast = Application.Rows.Count - 1
    Set rFormula = Range(&amp;#034D1:D&amp;#034 &amp; lLast)
    Set rArray = Range(&amp;#034C1:C&amp;#034 &amp; lLast)
    dTimer = Timer
    'For i = 0 To 99
        rArray.Calculate
    'Next i
    Debug.Print &amp;#034Array: &amp;#034 &amp; Timer - dTimer
    dTimer = Timer
    'For i = 0 To 99
        rFormula.Calculate
    'Next i
    Debug.Print &amp;#034Formula: &amp;#034 &amp; Timer - dTimer
End Sub
</code></pre>

<p>Internal Excel formulas tested were:</p>

<pre><code class="language-vbscript">=IF(MOD(A1,2)=0,A2,A1)
=IF(MOD(A1:A65535,2)=0,A2:A65536,A1:A65535)
</code></pre>

<p>The results of the above test showed a ratio of 7:10 formula over array formula.</p>

<p>The UDF formulas tested were:</p>

<pre><code class="language-vbscript">=SumDate($B$1:$B$65535,$A$1:$A$65535,A1,A1+5,TRUE)
=SumDate($B$1:$B$65535,$A$1:$A$65535,A1:$A$65535,A1:$A$65535+5,TRUE)
</code></pre>

<p>The results of the above test showed a ratio of 1465:1 formula over array formula. The resulting time is shown in the table below:</p>

<pre><code class="language-vbscript">Formula: 2610.16015625 seconds
Array: 1.78125 seconds
</code></pre>

</article>
<p>

    <span>Wed Mar 28, 2012</span>

   | 

  
    tags:
      <a href="/tags/excel">excel</a>
    
      <a href="/tags/formulas">formulas</a>
    
      <a href="/tags/array-formulas">array-formulas</a>
    
      <a href="/tags/efficiency">efficiency</a>
    
  

  

  

</p>


<div class="nav-posts">
  
    <a class="next" href="http://jnyman.com/2012/03/23/updates/"> Updates</a>
  

  
    
      
      ✴
      
      <a class="previous" href="http://jnyman.com/2012/03/29/why_udf_array_functions_are_faster/"> Why UDF Array Functions are Faster</a>
    
  
</div>


<div class="footer-menu">
  <ul>

    <li>
      <a class=" fa fa-rss fa-2x" href="/index.xml" title="RSS Feed"></a>
    </li>

    <li>
      <a class=" fa fa-github fa-2x" href="https://github.com/jon49/" title="Personal Github Account"></a>
    </li>

    <li>
      <a class=" fa fa-twitter fa-2x" href="https://twitter.com/NymanJon" title="Personal Twitter Account"></a>
    </li>

  </ul>
</div>

<footer>
  <p>
  © 2016 Jon Nyman
    <br>
    nymanjon@gmail.com
    <br>
    Hamsters Byte
  </p>
</footer>

</body>
</html>


<script src="/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
